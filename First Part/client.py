import socket

def receive_data(s):
        taille = ""
        data = b""
        flag = True
        while flag:
                ch = s.recv(1).decode()
                if(ch == "#"):
                        flag = False
                else:
                        taille += ch
        print(int(taille))
        for i in range(int(taille)):
                data += s.recv(1)
        return data
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("127.0.0.1", 1234))
while True:
        ordre = input("ORDRE : ")
        if(ordre == "ls"):
                s.sendall("LIST".encode())
                path_input = input("PATH : ")
                s.sendall(path_input.encode())
                print(receive_data(s).decode())
        elif(ordre == "dl"):
                s.sendall("DOWNLOAD".encode())
                file_input = input("WHAT FILE : ")
                file_name = file_input.split("/")
                filename = file_name[-1]
                print(filename)
                s.sendall(file_input.encode())
                #file_content = s.recv(1024).decode()
                file = receive_data(s)
                with open(str(filename), 'wb') as f:
                        f.write(file)
        elif(ordre == "up"):
                s.sendall('UPLOAD'.encode())
                file_input = input("WHAT FILE: ")
                file_name = file_input.split("/")
                filename = file_name[-1]
                s.sendall(filename.encode())
                #s.recv(1).decode()
                with open(file_input, 'rb') as f:
                        file_content = f.read()
                s.sendall((str(len(file_content))+"#").encode()+file_content)
        elif(ordre == "exit"):
                exit()
        else:
                print("ERROR")